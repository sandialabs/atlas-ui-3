# VTK.js Engineering Visualization Support

Atlas UI 3 now includes support for rendering engineering and scientific visualization files using VTK.js.

## Supported File Formats

The canvas panel can now render the following 3D file formats:

### VTK Legacy Formats
- **`.vtk`** - VTK Legacy PolyData format
  - Text or binary format for polygonal data
  - Common in scientific computing and engineering simulations

### VTK XML Formats
- **`.vtp`** - VTK PolyData (XML)
  - Polygonal data (meshes, surfaces)
- **`.vtu`** - VTK Unstructured Grid (XML)
  - Irregular 3D grids (FEM/CFD meshes)
- **`.vti`** - VTK Image Data (XML)
  - Regular 3D grids (structured volumes)
- **`.vts`** - VTK Structured Grid (XML)
  - Curvilinear grids
- **`.vtr`** - VTK Rectilinear Grid (XML)
  - Regular grids with variable spacing

### Common 3D Formats
- **`.stl`** - STereoLithography
  - Widely used for 3D printing and CAD
  - ASCII or binary format
- **`.obj`** - Wavefront OBJ
  - Common 3D model format
  - Supports geometry and materials
- **`.ply`** - Polygon File Format (Stanford Triangle Format)
  - Often used for 3D scanning data
  - Supports both ASCII and binary

### Modern 3D Formats
- **`.gltf`** - GL Transmission Format
  - JSON-based 3D scene description
- **`.glb`** - Binary GLTF
  - Binary version of GLTF

## Features

### Interactive 3D Viewer
- **Rotate**: Left-click and drag to rotate the model
- **Pan**: Right-click and drag to pan the view
- **Zoom**: Mouse wheel to zoom in/out
- **Reset View**: Button to reset camera to default position
- **Zoom In/Out**: Buttons for precise zoom control

### Automatic File Detection
The system automatically detects file types based on extension and routes them to the appropriate viewer. When a VTK-compatible file is uploaded or generated by a tool, it will be rendered in the 3D viewer.

## Usage

### Via Tool Integration
When MCP tools generate VTK files, they will automatically appear in the canvas panel with the 3D viewer.

Example tool output that would be visualized:
```python
# Tool generates a VTK file
with open("simulation_output.vtp", "wb") as f:
    f.write(vtp_data)
```

### Via File Upload
Users can upload supported 3D files through the chat interface, and they will be rendered in the canvas panel.

### Via Canvas Tool
The AI can use the canvas tool to display VTK files:
```
Use the canvas to show me the 3D model from simulation_results.stl
```

## Technical Details

### VTK.js Integration
The viewer uses [VTK.js](https://kitware.github.io/vtk-js/), a JavaScript implementation of the Visualization Toolkit, which provides:
- High-performance 3D rendering using WebGL
- Support for large scientific datasets
- Comprehensive file format support
- Interactive manipulation tools

### Rendering Pipeline
1. File is detected as VTK-compatible based on extension
2. File content is fetched (either from S3 or inline base64)
3. Appropriate VTK.js reader is selected based on format
4. Data is parsed and converted to VTK PolyData
5. Mapper and Actor are created with default material properties
6. Scene is rendered with camera positioned to show entire model

### Default Material Properties
- Color: Light blue-gray (0.8, 0.8, 0.9)
- Ambient: 0.3
- Diffuse: 0.7
- Specular: 0.3
- Specular Power: 30

## Limitations

1. **File Size**: Large files (>50MB) may take time to load and render
2. **Browser Memory**: Complex models with millions of polygons may require significant memory
3. **Format Support**: Some advanced VTK features (cell data, field data) may not be fully rendered
4. **Textures**: Texture support is limited to formats that include texture information (OBJ, GLTF)

## Future Enhancements

Potential improvements for future versions:
- Color mapping for scalar fields
- Support for vector field visualization
- Animation support for time-series data
- Section/slice plane tools
- Measurement tools (distance, angle)
- Export rendered views as images
- Lighting and material customization
- Multiple viewport support for side-by-side comparison

## Examples

### CFD Simulation Results
```
Upload a .vtu file from your CFD simulation and view the mesh with flow fields
```

### 3D Printed Part
```
Upload an .stl file to preview your 3D print before manufacturing
```

### Point Cloud Data
```
Upload a .ply file from 3D scanning to visualize the captured geometry
```

### Engineering Analysis
```
Upload a .vtk file with FEM results to visualize stress distributions
```

## Troubleshooting

### File Not Displaying
- Check that file extension is supported
- Verify file is not corrupted
- Try opening in native VTK viewer (ParaView) to confirm validity

### Slow Performance
- Reduce mesh complexity by decimating/simplifying geometry
- Convert to binary format if using ASCII
- Split large datasets into smaller chunks

### Rendering Issues
- Clear browser cache and reload
- Try different browser (Chrome/Firefox recommended)
- Check browser console for JavaScript errors

## References

- [VTK.js Documentation](https://kitware.github.io/vtk-js/)
- [VTK File Formats](https://vtk.org/wp-content/uploads/2015/04/file-formats.pdf)
- [ParaView (Desktop VTK Viewer)](https://www.paraview.org/)
