# Atlas CLI and Python API

Last updated: 2026-01-27 20:30

## Overview

Atlas provides a non-interactive CLI and Python API for one-shot LLM chat with full MCP tools and RAG support -- no browser or WebSocket needed.

## Tool Naming Convention

Tool names are fully qualified as `{serverName}_{toolName}`, where `serverName` is the key in `mcp.json` and `toolName` is the function name registered in the MCP server.

Default servers from `config/defaults/mcp.json` and their tools:

| Server | Tool name(s) | Description |
|--------|-------------|-------------|
| `calculator` | `calculator_evaluate` | Evaluate math expressions |
| `pdfbasic` | `pdfbasic_*` | PDF text extraction and analysis |
| `code-executor` | `code-executor_*` | Sandboxed code execution |
| `ui-demo` | `ui-demo_*` | UI customization demo |
| `prompts` | (prompts only, no tools) | System prompt overrides |
| `env-demo` | `env-demo_*` | Environment variable demo |

The special pseudo-tool `canvas_canvas` is always available regardless of selection.

## CLI Usage

```bash
cd backend

# Basic prompt
python atlas_chat_cli.py "Summarize the latest docs" --model gpt-4o

# With tools
python atlas_chat_cli.py "What is 355/113 +sin0.23)*897^1.23. use the tool" --tools calculator_evaluate

# Multiple tools
python atlas_chat_cli.py "Calculate 2^10 then execute print('hello') in Python" \
  --tools calculator_evaluate,code-executor_execute_code

# Read prompt from stdin
echo "Explain quantum computing" | python atlas_chat_cli.py -

# JSON output (structured result with tool_calls, files, etc.)
python atlas_chat_cli.py "What is 2+2?" --tools calculator_evaluate --json

# List available tools (prints in the format used by --tools)
python atlas_chat_cli.py --list-tools
```

### CLI Flags

| Flag | Description |
|------|-------------|
| `prompt` | Positional prompt text, or `-` for stdin |
| `--model` | LLM model name (default from config) |
| `--tools` | Comma-separated fully-qualified tool names (`serverName_toolName`) |
| `--json` | Output structured JSON |
| `--user-email` | Override user identity |
| `--list-tools` | Print available tools and exit |

### Exit Codes

- `0` - Success
- `1` - Runtime error
- `2` - Bad arguments (no prompt provided)

## Python API

```python
import asyncio
from atlas_client import AtlasClient

async def main():
    client = AtlasClient()
    result = await client.chat(
        prompt="What is 355 divided by 113?",
        model="gpt-4o",
        selected_tools=["calculator_evaluate"],
    )
    print(result.message)
    print(result.tool_calls)
    await client.cleanup()

asyncio.run(main())
```

### Using multiple tools

```python
result = await client.chat(
    prompt="Calculate 2^10 then run print('hello') in Python",
    selected_tools=["calculator_evaluate", "code-executor_execute_code"],
)
```

### Sync usage

```python
from atlas_client import AtlasClient

client = AtlasClient()
result = client.chat_sync(
    "What is 2+2?",
    model="gpt-4o",
    selected_tools=["calculator_evaluate"],
)
print(result.message)
```

### ChatResult fields

| Field | Type | Description |
|-------|------|-------------|
| `message` | `str` | Assistant's text response |
| `tool_calls` | `list[dict]` | Tool invocations with name, status, result |
| `files` | `dict` | Session files produced by tools |
| `canvas_content` | `str or None` | HTML/markdown canvas content |

## Configuration

The CLI uses the same configuration as the web app:
- `.env` for environment variables
- `config/defaults/` and `config/overrides/` for LLM, MCP, and RAG config
- MCP tool discovery runs automatically on first use
- Tool servers are defined in `config/defaults/mcp.json` (or `config/overrides/mcp.json`)

To see which tools are available, check the server keys in your `mcp.json` and the `@mcp.tool` decorated functions in each server's `main.py`.

### Tool Approval

In the web UI, tools may require user approval before execution (configured via `require_approval` in `mcp.json`). The CLI automatically approves all tool calls since there is no interactive approval UI. This applies to both tools mode and agent mode.

## Use Cases

- **E2E testing**: Script chat interactions for automated testing
- **MCP development**: Test tool servers without starting the full UI
- **Scripted workflows**: Chain LLM calls in shell scripts or Python
- **CI/CD**: Validate LLM + tool integrations in pipelines
